<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Uçak Yükleme Hesaplama (Mobil v6)</title>
  <style>
    :root{
      --bg:#0b0b0b; --card:#151515; --card2:#101010;
      --text:#ffffff; --muted:#bdbdbd; --border:#2d2d2d;
      --accent:#00e0ff; --warn:#ffcc00; --bad:#ff4d4d;
      --shadow: 0 10px 30px rgba(0,0,0,.45); --r:16px;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    }
    .wrap{ max-width: 580px; margin: 0 auto; padding: 14px 14px 140px; }
    header{
      position: sticky; top: 0; z-index: 20;
      background: linear-gradient(to bottom, rgba(11,11,11,0.98), rgba(11,11,11,0.86));
      backdrop-filter: blur(10px);
      padding: 10px 0 10px; margin: 0 0 12px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }
    .titleRow{ display:flex; align-items:flex-start; justify-content:space-between; gap:10px; padding: 0 2px; }
    h1{ font-size: 18px; margin:0; letter-spacing:.2px; font-weight: 900; }
    .sub{
      margin-top:6px; font-size: 12px; color: var(--muted);
      display:flex; flex-wrap:wrap; gap:8px; align-items:center;
    }
    .pill,.chip{
      font-size: 12px; color: var(--muted);
      border: 1px solid var(--border);
      padding: 6px 10px; border-radius: 999px;
      background: rgba(255,255,255,0.03); white-space:nowrap;
    }
    .chip.bad{ color: #fff; border-color: rgba(255,77,77,.5); background: rgba(255,77,77,.12); }
    .chip.warn{ color: #fff; border-color: rgba(255,204,0,.55); background: rgba(255,204,0,.12); }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--r);
      box-shadow: var(--shadow);
      padding: 14px; margin-bottom: 12px;
    }
    .card.secondary{ background: var(--card2); }

    .grid2{ display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .grid3{ display:grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; }

    label{
      display:block; font-size: 13px; color: var(--muted);
      margin: 0 0 6px; font-weight: 750; letter-spacing:.2px;
    }
    .field{ display:flex; flex-direction:column; }

    select, input[type="number"], input[type="text"]{
      width:100%;
      background: rgba(255,255,255,0.06);
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: 14px;
      padding: 12px 12px;
      font-size: 18px;
      outline: none;
    }
    select{
      appearance: none; -webkit-appearance: none; -moz-appearance: none;
      padding-right: 44px;
      background-image:
        linear-gradient(45deg, transparent 50%, rgba(255,255,255,0.7) 50%),
        linear-gradient(135deg, rgba(255,255,255,0.7) 50%, transparent 50%),
        linear-gradient(to right, transparent, transparent);
      background-position:
        calc(100% - 18px) calc(50% - 4px),
        calc(100% - 12px) calc(50% - 4px),
        100% 0;
      background-size: 6px 6px, 6px 6px, 2.6em 2.6em;
      background-repeat: no-repeat;
    }
    option{ background: #101010; color: #ffffff; }
    input[type="number"]{ -moz-appearance: textfield; }
    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button{ -webkit-appearance: none; margin: 0; }

    select:focus, input:focus{
      border-color: rgba(0,224,255,.75);
      box-shadow: 0 0 0 3px rgba(0,224,255,.15);
    }
    input[readonly]{ opacity: .92; background: rgba(255,255,255,0.04); }

    .hint{ margin-top: 8px; color: var(--muted); font-size: 12px; line-height: 1.25rem; }
    .divider{ height:1px; background: var(--border); margin: 12px 0; opacity:.8; }

    .btns{ display:flex; gap:10px; flex-wrap:wrap; margin-top: 6px; }
    button{
      appearance:none; border:none; cursor:pointer;
      border-radius: 14px; padding: 12px 14px;
      font-size: 14px; font-weight: 850; letter-spacing:.2px;
      color: var(--text);
      background: rgba(255,255,255,0.08);
      border: 1px solid var(--border);
      min-height: 44px;
      flex: 1 1 auto;
    }
    button:active{ transform: translateY(1px); }
    .btn-primary{
      background: linear-gradient(180deg, rgba(0,224,255,.25), rgba(0,224,255,.12));
      border-color: rgba(0,224,255,.35);
    }
    .btn-danger{
      background: linear-gradient(180deg, rgba(255,60,60,.22), rgba(255,60,60,.10));
      border-color: rgba(255,60,60,.35);
    }

    .stat{
      display:flex; flex-direction:column; gap:6px;
      padding: 12px; border-radius: 14px;
      background: rgba(255,255,255,0.04);
      border: 1px solid var(--border);
      min-width: 140px;
    }
    .stat .k{ color: var(--muted); font-size: 12px; font-weight:750; }
    .stat .v{ color: var(--accent); font-size: 18px; font-weight: 950; letter-spacing:.2px; }
    .stat .v.warn{ color: var(--warn); }

    .compBar{
      display:flex; gap:10px; overflow-x:auto; -webkit-overflow-scrolling: touch;
      padding-bottom: 6px; margin-top: 10px;
    }
    .compBar::-webkit-scrollbar{ height: 6px; }
    .compBar::-webkit-scrollbar-thumb{ background: rgba(255,255,255,0.12); border-radius: 999px; }

    .tableWrap{
      overflow-x: auto; -webkit-overflow-scrolling: touch;
      border-radius: 14px; border: 1px solid var(--border);
      background: rgba(255,255,255,0.03);
    }
    table{ width: 100%; border-collapse: collapse; min-width: 520px; }
    th, td{
      padding: 10px 8px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
      text-align:center; font-size: 13px;
    }
    th{
      position: sticky; top: 0;
      background: #1b1b1b; z-index: 2;
      font-size: 12px; color: var(--muted);
      letter-spacing:.3px; text-transform: uppercase;
    }
    td.num{ text-align:right; font-variant-numeric: tabular-nums; }
    td.comp{ font-weight: 900; }
    .cellInput{
      width: 92px; max-width: 100%;
      margin: 0 auto; padding: 10px 10px;
      font-size: 16px; border-radius: 12px;
    }
    tr.totalRow{ background: rgba(255,255,255,0.04); }
    tr.totalRow td{ font-weight: 900; }
    tr.totalRow td:last-child{ color: var(--warn); }

    .sticky{
      position: fixed; left: 0; right: 0; bottom: 0;
      padding: 10px 12px calc(10px + env(safe-area-inset-bottom));
      background: linear-gradient(to top, rgba(11,11,11,0.98), rgba(11,11,11,0.86));
      border-top: 1px solid rgba(255,255,255,0.08);
      backdrop-filter: blur(10px);
      z-index: 30;
    }
    .stickyInner{
      max-width: 580px; margin: 0 auto;
      display:grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;
    }
    .sticky .stat{ box-shadow:none; min-width: unset; }

    @media (max-width:420px){
      .grid2, .grid3{ grid-template-columns: 1fr; }
      table{ min-width: 480px; }
      .cellInput{ width: 84px; }
      .stat{ min-width: 0; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div class="titleRow">
        <div>
          <h1>Uçak Yükleme Hesaplama</h1>
          <div class="sub">
            <span class="pill" id="clockPill">—</span>
            <span class="pill" id="datePill">—</span>
          </div>
        </div>
        <div class="chip" id="statusChip">Hazır</div>
      </div>
    </header>

    <div class="card">
      <div class="grid2">
        <div class="field">
          <label>Uçak Kuyruğu (Tail)</label>
          <input type="text" id="tailNo" placeholder="örn. TC-JFO" autocapitalize="characters" />
          <div class="hint">Sadece kontrol amaçlı. Kaydet ile cihazda saklanır.</div>
        </div>

        <div class="field">
          <label>Crew (Gösterge)</label>
          <select id="crewCode">
            <option value="">Seçiniz</option>
            <optgroup label="2/ ...">
              <option>2/0</option><option>2/4</option><option>2/5</option><option>2/6</option>
              <option>2/10</option><option>2/11</option><option>2/12</option><option>2/14</option>
            </optgroup>
            <optgroup label="3/ ...">
              <option>3/0</option><option>3/4</option><option>3/5</option><option>3/6</option>
              <option>3/10</option><option>3/11</option><option>3/12</option><option>3/14</option>
            </optgroup>
          </select>
          <div class="hint">Toplam yüke eklenmez.</div>
        </div>
      </div>

      <div class="divider"></div>

      <div class="grid2">
        <div class="field">
          <label>Uçak Tipi</label>
          <select id="aircraft">
            <option value="">Seçiniz</option>
            <option value="B737">Boeing 737</option>
            <option value="A319">Airbus A319</option>
            <option value="A320">Airbus A320</option>
            <option value="A321">Airbus A321</option>
            <option value="A330">Airbus A330</option>
            <option value="A350">Airbus A350</option>
            <option value="B777">Boeing 777</option>
            <option value="B787">Boeing 787</option>
            <option value="A319B">Airbus A319 Bulk</option>
            <option value="A320B">Airbus A320 Bulk</option>
            <option value="A321B">Airbus A321 Bulk</option>
          </select>
          <div class="hint">Uçak seçilince tablo açılır.</div>
        </div>

        <div class="field">
          <label>Hızlı İşlemler</label>
          <div class="btns">
            <button class="btn-primary" id="btnSave">Kaydet</button>
            <button class="btn-danger" id="btnReset">Sıfırla</button>
          </div>
          <div class="hint">Kaydet: cihazda saklar.</div>
        </div>
      </div>

      <div class="divider"></div>

      <div class="grid2">
        <div class="field">
          <label>Toplam Bagaj Ağırlığı (kg)</label>
          <input type="number" id="bagTotalKg" inputmode="numeric" placeholder="örn. 2450" />
        </div>
        <div class="field">
          <label>Bagaj Parça Sayısı (PCS)</label>
          <input type="number" id="bagPieces" inputmode="numeric" placeholder="örn. 122" />
        </div>
      </div>

      <div class="grid2" style="margin-top:10px;">
        <div class="field">
          <label>Ortalama Bagaj (kg) — otomatik</label>
          <input type="text" id="avgBag" readonly value="" placeholder="—" />
          <div class="hint">Toplam Bagaj Kg / PCS</div>
        </div>

        <div class="field">
          <label>Meta</label>
          <input type="text" id="metaLine" readonly value="" placeholder="—" />
          <div class="hint">Tail • Crew • Aircraft</div>
        </div>
      </div>
    </div>

    <div class="card secondary">
      <div class="grid2">
        <div class="field">
          <label>Total Fuel (kg)</label>
          <input type="number" id="totalFuel" inputmode="numeric" />
        </div>
        <div class="field">
          <label>Taxi Fuel (kg)</label>
          <input type="number" id="taxiFuel" inputmode="numeric" />
        </div>
      </div>

      <div class="divider"></div>

      <div class="grid3">
        <div class="stat"><div class="k">Total</div><div class="v" id="totalFuelEcho">—</div></div>
        <div class="stat"><div class="k">Remaining</div><div class="v warn" id="remainFuel">—</div></div>
        <div class="stat"><div class="k">Taxi</div><div class="v" id="taxiFuelEcho">—</div></div>
      </div>
      <div class="hint">Remaining = Total − Taxi</div>
    </div>

    <div class="card" id="compTotalsCard" style="display:none;">
      <div style="font-weight:900;">Kompartman Toplamları (kg)</div>
      <div class="compBar" id="compBar"></div>
      <div class="hint">Bulk uçakta gösterilmez. Her kutu: (Bagaj kg + Kargo kg)</div>
    </div>

    <div class="card">
      <div class="hint">Uçak tipi seçince kompartmanlar açılır. Bag Sayısı ve Kargo Kg gir.</div>
      <div class="tableWrap" style="display:none;" id="tableWrap">
        <table id="table">
          <thead>
            <tr>
              <th>Kompartman</th>
              <th>Bagaj Sayısı</th>
              <th>Bagaj Kg</th>
              <th>Kargo Kg</th>
              <th>Toplam Kg</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="sticky" id="sticky" style="display:none;">
    <div class="stickyInner">
      <div class="stat"><div class="k">Toplam Bagaj</div><div class="v" id="sumBag">0.0</div></div>
      <div class="stat"><div class="k">Toplam Kargo</div><div class="v" id="sumCargo">0.0</div></div>
      <div class="stat"><div class="k">Toplam Yük</div><div class="v" id="sumTotal">0.0</div></div>
    </div>
  </div>

<script>
  const aircraftComps = {
    "B737": ["1","2","3","4"],
    "A319": ["11","12","41","42","51"],
    "A320": ["11","12","13","31","32","41","42","5"],
    "A321": ["11","12","21","22","23","31","32","33","41","42","5"],
    "A330": ["1","2","3","4","5"],
    "A350": ["1","2","3","4","5"],
    "B777": ["1","2","3","4","5"],
    "B787": ["1","2","3","4","5"],
    "A319B": ["1","4.5"],
    "A320B": ["1","3","4","5"],
    "A321B": ["1","2","3","4","5"]
  };
  const bulkAircraft = new Set(["A319B","A320B","A321B"]);

  let compartments = [];
  const $ = (id)=>document.getElementById(id);

  const tbody = $("tbody");
  const tableWrap = $("tableWrap");
  const statusChip = $("statusChip");
  const compTotalsCard = $("compTotalsCard");
  const compBar = $("compBar");

  function setStatus(kind, text){
    statusChip.classList.remove("warn","bad");
    if(kind) statusChip.classList.add(kind);
    statusChip.textContent = text;
  }

  function safeNum(v){
    if(v===null || v===undefined) return null;
    if(v==="") return null;
    const n = Number(v);
    return Number.isFinite(n) ? n : null;
  }

  function updateClock(){
    const now = new Date();
    $("clockPill").textContent = "Saat: " + now.toLocaleTimeString("tr-TR", {hour:"2-digit", minute:"2-digit", second:"2-digit"});
    $("datePill").textContent = now.toLocaleDateString("tr-TR", {weekday:"long", year:"numeric", month:"2-digit", day:"2-digit"});
  }

  function calcAvgBag(){
    const totalKg = safeNum($("bagTotalKg").value);
    const pcs = safeNum($("bagPieces").value);
    if(totalKg===null || pcs===null || pcs<=0){
      $("avgBag").value = "";
      return {avg:0, ok:false};
    }
    const avg = totalKg / pcs;
    $("avgBag").value = avg.toFixed(2);
    return {avg, ok:true};
  }

  function calcFuel(){
    const totalVal = $("totalFuel").value;
    const taxiVal  = $("taxiFuel").value;
    const total = safeNum(totalVal) ?? 0;
    const taxi  = safeNum(taxiVal)  ?? 0;

    $("totalFuelEcho").textContent = (totalVal==="" ? "—" : total.toFixed(0) + " kg");
    $("taxiFuelEcho").textContent  = (taxiVal==="" ? "—" : taxi.toFixed(0) + " kg");

    if(totalVal==="" && taxiVal===""){
      $("remainFuel").textContent = "—";
      return;
    }
    $("remainFuel").textContent = (total - taxi).toFixed(0) + " kg";
  }

  function updateMetaLine(){
    const tail = ($("tailNo").value || "—").trim().toUpperCase();
    const crew = $("crewCode").value || "—";
    const ac = $("aircraft").value || "—";
    $("metaLine").value = `${tail} • ${crew} • ${ac}`;
  }

  function buildTable(){
    tbody.innerHTML = "";
    compartments.forEach(c=>{
      const row = document.createElement("tr");
      row.innerHTML = `
        <td class="comp">${c.name}</td>
        <td><input class="cellInput bagInput" inputmode="numeric" type="number" data-comp="${c.name}" placeholder="0"></td>
        <td class="num bagKgCell">0.0</td>
        <td><input class="cellInput cargoInput" inputmode="numeric" type="number" data-comp="${c.name}" placeholder="0"></td>
        <td class="num totalCell">0.0</td>`;
      tbody.appendChild(row);
    });

    tbody.querySelectorAll(".bagInput").forEach(inp=>{
      inp.addEventListener("input", ()=>{
        const comp = compartments.find(x=>x.name===inp.dataset.comp);
        comp.bags = inp.value==="" ? null : parseFloat(inp.value);
        updateValues();
      });
    });
    tbody.querySelectorAll(".cargoInput").forEach(inp=>{
      inp.addEventListener("input", ()=>{
        const comp = compartments.find(x=>x.name===inp.dataset.comp);
        comp.cargo = inp.value==="" ? null : parseFloat(inp.value);
        updateValues();
      });
    });
  }

  function addGroupRow(names,label, avg){
    let bagSum=0, cargoSum=0;
    names.forEach(n=>{
      const c = compartments.find(x=>x.name===n);
      if(c){
        bagSum += (c.bags||0)*avg;
        cargoSum += (c.cargo||0);
      }
    });
    const row = document.createElement("tr");
    row.className = "totalRow";
    row.innerHTML = `<td colspan="4" style="text-align:left;padding-left:10px;">${label}</td>
                     <td class="num">${(bagSum+cargoSum).toFixed(1)}</td>`;
    tbody.appendChild(row);
  }

  function renderCompBar(nonBulk, avg){
    compBar.innerHTML = "";
    if(!nonBulk){
      compTotalsCard.style.display = "none";
      return;
    }
    compartments.forEach(c=>{
      const bagKg = (c.bags||0) * avg;
      const total = bagKg + (c.cargo||0);
      const el = document.createElement("div");
      el.className = "stat";
      el.innerHTML = `<div class="k">Comp ${c.name}</div><div class="v">${total.toFixed(1)} kg</div>`;
      compBar.appendChild(el);
    });
    compTotalsCard.style.display = "block";
  }

  function anyBagInput(){
    return compartments.some(c => (c.bags||0) > 0);
  }

  function updateValues(){
    try{
      const ac = $("aircraft").value;
      const active = !!ac;

      const avgRes = calcAvgBag();
      const avg = avgRes.avg;

      updateMetaLine();
      calcFuel();

      // update row cells
      const compRows = tbody.querySelectorAll("tr");
      compartments.forEach((c,i)=>{
        const bagKg = (c.bags||0) * avg;
        const total = bagKg + (c.cargo||0);
        const r = compRows[i];
        if(!r) return;
        r.querySelector(".bagKgCell").textContent = bagKg.toFixed(1);
        r.querySelector(".totalCell").textContent = total.toFixed(1);
      });

      // remove old group rows and rebuild (for A319/320/321)
      tbody.querySelectorAll(".totalRow").forEach(r=>r.remove());
      if(ac==="A319"){
        addGroupRow(["11","12"],"11+12 Toplam", avg);
        addGroupRow(["41","42"],"41+42 Toplam", avg);
        addGroupRow(["51"],"51 Toplam", avg);
      }
      if(ac==="A320"){
        addGroupRow(["11","12","13"],"11+12+13 Toplam", avg);
        addGroupRow(["31","32"],"31+32 Toplam", avg);
        addGroupRow(["41","42"],"41+42 Toplam", avg);
        addGroupRow(["5"],"5 Toplam", avg);
      }
      if(ac==="A321"){
        addGroupRow(["11","12"],"11+12 Toplam", avg);
        addGroupRow(["21","22","23"],"21+22+23 Toplam", avg);
        addGroupRow(["31","32","33"],"31+32+33 Toplam", avg);
        addGroupRow(["41","42"],"41+42 Toplam", avg);
        addGroupRow(["5"],"5 Toplam", avg);
      }

      // totals
      let totalBag=0, totalCargo=0;
      compartments.forEach(c=>{
        totalBag += (c.bags||0)*avg;
        totalCargo += (c.cargo||0);
      });
      $("sumBag").textContent   = totalBag.toFixed(1);
      $("sumCargo").textContent = totalCargo.toFixed(1);
      $("sumTotal").textContent = (totalBag+totalCargo).toFixed(1);

      $("sticky").style.display = active ? "block" : "none";

      const nonBulk = active && !bulkAircraft.has(ac);
      renderCompBar(nonBulk, avg);

      // status logic
      if(!active){
        setStatus("", "Hazır");
      }else if(!avgRes.ok && anyBagInput()){
        setStatus("warn", "Avg eksik (Bag kg/PCS)");
      }else{
        setStatus("", "Aktif");
      }
    }catch(e){
      setStatus("bad", "Hata");
      console.error(e);
    }
  }

  function resetAll(){
    $("tailNo").value = "";
    $("crewCode").value = "";
    $("aircraft").value = "";
    $("bagTotalKg").value = "";
    $("bagPieces").value = "";
    $("avgBag").value = "";
    $("metaLine").value = "";
    $("totalFuel").value = "";
    $("taxiFuel").value = "";

    compartments = [];
    tbody.innerHTML = "";
    tableWrap.style.display = "none";
    $("sticky").style.display = "none";
    compTotalsCard.style.display = "none";

    $("totalFuelEcho").textContent = "—";
    $("taxiFuelEcho").textContent = "—";
    $("remainFuel").textContent = "—";

    localStorage.removeItem("loadcalc_v6");
    setStatus("", "Hazır");
    updateValues();
  }

  function saveLocal(){
    const payload = {
      tailNo: $("tailNo").value,
      crewCode: $("crewCode").value,
      aircraft: $("aircraft").value,
      bagTotalKg: $("bagTotalKg").value,
      bagPieces: $("bagPieces").value,
      totalFuel: $("totalFuel").value,
      taxiFuel: $("taxiFuel").value,
      compartments: compartments
    };
    localStorage.setItem("loadcalc_v6", JSON.stringify(payload));
    setStatus("", "Kaydedildi");
    setTimeout(()=>setStatus($("aircraft").value ? "" : "", $("aircraft").value ? "Aktif" : "Hazır"), 900);
  }

  function loadLocal(){
    try{
      const raw = localStorage.getItem("loadcalc_v6");
      if(!raw) return;
      const p = JSON.parse(raw);
      $("tailNo").value = p.tailNo || "";
      $("crewCode").value = p.crewCode || "";
      $("aircraft").value = p.aircraft || "";
      $("bagTotalKg").value = p.bagTotalKg || "";
      $("bagPieces").value = p.bagPieces || "";
      $("totalFuel").value = p.totalFuel || "";
      $("taxiFuel").value = p.taxiFuel || "";

      const ac = $("aircraft").value;
      if(ac && aircraftComps[ac]){
        compartments = aircraftComps[ac].map(name=>{
          const found = (p.compartments||[]).find(x=>x.name===name);
          return { name, bags: found?.bags ?? null, cargo: found?.cargo ?? null };
        });
        tableWrap.style.display = "block";
        buildTable();

        tbody.querySelectorAll(".bagInput").forEach(inp=>{
          const c = compartments.find(x=>x.name===inp.dataset.comp);
          if(c && c.bags !== null) inp.value = c.bags;
        });
        tbody.querySelectorAll(".cargoInput").forEach(inp=>{
          const c = compartments.find(x=>x.name===inp.dataset.comp);
          if(c && c.cargo !== null) inp.value = c.cargo;
        });
      }else{
        compartments = [];
        tbody.innerHTML = "";
        tableWrap.style.display = "none";
      }
    }catch(e){
      console.error(e);
    }
  }

  $("aircraft").addEventListener("change", ()=>{
    const ac = $("aircraft").value;
    tbody.innerHTML = "";
    compartments = [];
    if(ac && aircraftComps[ac]){
      tableWrap.style.display = "block";
      aircraftComps[ac].forEach(name=>compartments.push({name, bags:null, cargo:null}));
      buildTable();
    }else{
      tableWrap.style.display = "none";
      $("sticky").style.display = "none";
      compTotalsCard.style.display = "none";
    }
    updateValues();
  });

  ["tailNo","crewCode","bagTotalKg","bagPieces","totalFuel","taxiFuel"].forEach(id=>{
    $(id).addEventListener("input", updateValues);
    $(id).addEventListener("change", updateValues);
  });

  $("btnReset").addEventListener("click", resetAll);
  $("btnSave").addEventListener("click", saveLocal);

  // Boot
  updateClock();
  setInterval(updateClock, 1000);
  loadLocal();
  // force rebuild table if aircraft stored
  const storedAc = $("aircraft").value;
  if(storedAc && aircraftComps[storedAc] && compartments.length){
    tableWrap.style.display = "block";
    buildTable();
    // restore values again after rebuild
    tbody.querySelectorAll(".bagInput").forEach(inp=>{
      const c = compartments.find(x=>x.name===inp.dataset.comp);
      if(c && c.bags !== null) inp.value = c.bags;
    });
    tbody.querySelectorAll(".cargoInput").forEach(inp=>{
      const c = compartments.find(x=>x.name===inp.dataset.comp);
      if(c && c.cargo !== null) inp.value = c.cargo;
    });
  }
  updateValues();
</script>
</body>
</html>
